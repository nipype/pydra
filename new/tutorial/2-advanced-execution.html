<!doctype html>
<html class="no-js" lang="English" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Troubleshooting" href="3-troubleshooting.html" /><link rel="prev" title="Getting started" href="1-getting-started.html" />

    <link rel="shortcut icon" href="../_static/pydra_logo.png"/><!-- Generated with Sphinx 6.2.1 and Furo 2024.08.06 -->
        <title>Advanced execution - Pydra v0.25</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=04c057b233f3c8d71940eee6080f658a04e2027d" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=cf727022eb7470bc603c08d2e55c3247faec75c9" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: black;
  --color-brand-primary: #69306d;
  --color-brand-content: #69306d;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #111111;
  --color-code-foreground: #ffffff;
  --color-brand-primary: #ce8dcf;
  --color-brand-content: #ce8dcf;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #111111;
  --color-code-foreground: #ffffff;
  --color-brand-primary: #ce8dcf;
  --color-brand-content: #ce8dcf;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Pydra v0.25</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/pydra_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Pydra v0.25</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Tutorials: Execution</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-getting-started.html">Getting started</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Advanced execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-troubleshooting.html">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials: Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="4-python.html">Python-tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-shell.html">Shell-tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-workflow.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-canonical-form.html">Canonical task form</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/t1w-preprocess.html">T1w MRI preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/glm.html">General Linear Model (GLM)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../howto/create-task-package.html">Create a task package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/port-from-nipype.html">Port interfaces from Nipype</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanation/design-approach.html">Design philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/splitting-combining.html">Splitting and combining</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/conditional-lazy.html">Dynamic construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/environments.html">Software environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/hashing-caching.html">Caches and hashes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanation/typing.html">Typing and file-formats</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../py-modindex.html">Module Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/tutorial/2-advanced-execution.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="Advanced-execution">
<h1>Advanced execution<a class="headerlink" href="#Advanced-execution" title="Permalink to this heading">¶</a></h1>
<p>One of the key design features of Pydra is the separation between the parameterisation of the task to be executed, and the parameresiation of where and how the task should be executed (e.g. on the cloud, on a HPC cluster, …). This tutorial steps you through some of the available options for executing a task.</p>
<p><a class="reference external" href="https://mybinder.org/v2/gh/nipype/pydra-tutorial/develop/notebooks/tutorial/advanced_execution.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<p>Remember that before attempting to run multi-process code in Jupyter notebooks, the following snippet must be called</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nest_asyncio</span>

<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Submitter">
<h2>Submitter<a class="headerlink" href="#Submitter" title="Permalink to this heading">¶</a></h2>
<p>If you want to access a richer <code class="docutils literal notranslate"><span class="pre">Result</span></code> object you can use a Submitter object to initiate the task execution. For example, using the <code class="docutils literal notranslate"><span class="pre">TenToThePower</span></code> task from the testing package</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydra.engine.submitter</span> <span class="kn">import</span> <span class="n">Submitter</span>
<span class="kn">from</span> <span class="nn">pydra.tasks.testing</span> <span class="kn">import</span> <span class="n">TenToThePower</span>


<span class="n">ten_to_the_power</span> <span class="o">=</span> <span class="n">TenToThePower</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Submitter</span><span class="p">()</span> <span class="k">as</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">submitter</span><span class="p">(</span><span class="n">ten_to_the_power</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
A newer version (0.25) of nipype/pydra is available. You are using 0.25.dev391+g33014fac
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Result(output_dir=PosixPath(&#39;/home/runner/.cache/pydra/0.25.dev391+g33014fac/run-cache/python-db220e60910684fecc13e32d80ad7991&#39;), outputs=TenToThePowerOutputs(out=1000), runtime=None, errored=False, definition=TenToThePower(p=3))
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Result</span></code> object contains</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">output</span></code>: the outputs of the task (if there is only one output it is called <code class="docutils literal notranslate"><span class="pre">out</span></code> by default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime</span></code>: information about the peak memory and CPU usage</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">errored</span></code>: the error status of the task</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">task</span></code>: the task object that generated the results</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_dir</span></code>: the output directory the results are stored in</p></li>
</ul>
</section>
<section id="Workers">
<h2>Workers<a class="headerlink" href="#Workers" title="Permalink to this heading">¶</a></h2>
<p>Pydra supports several workers with which to execute tasks</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code> (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slurm</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sge</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">psij</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dask</span></code> (experimental)</p></li>
</ul>
<p>By default, the <em>debug</em> worker is used, which runs tasks serially in a single process without use of the <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> module. This makes it easier to debug errors in workflows and python tasks, however, when using in Pydra in production you will typically want to parallelise the execution for efficiency.</p>
<p>If running on a local workstation, then the <code class="docutils literal notranslate"><span class="pre">cf</span></code> (<em>ConcurrentFutures</em>) worker is a good option because it is able to spread the tasks to be run over multiple processes and maximise CPU usage.</p>
<p>If you have access to a high-performance cluster (HPC) then the <a class="reference external" href="https://slurm.schedmd.com/documentation.html">SLURM</a> and <a class="reference external" href="https://www.metagenomics.wiki/tools/hpc-sge">SGE</a> and <a class="reference external" href="https://exaworks.org/psij">PSI/J</a> workers can be used to submit each workflow node as separate jobs to the HPC scheduler. There is also an experimental <a class="reference external" href="https://www.dask.org/">Dask</a> worker, which provides a range of execution backends to choose from.</p>
<p>To specify a worker, the abbreviation can be passed either as a string or using the class itself. Additional parameters can be passed to the worker initialisation as keyword arguments to the execution call. For example, if we wanted to run five tasks using the ConcurentFutures worker but only use three CPUs, we can pass <code class="docutils literal notranslate"><span class="pre">n_procs=3</span></code> to the execution call.</p>
<p>Remember that when calling multi-process code in a top level script the call must be enclosed within a <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> block to allow the worker processes to import the module without re-executing it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">cache_root</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">ten_to_the_power</span> <span class="o">=</span> <span class="n">TenToThePower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

    <span class="c1"># Run the 5 tasks in parallel split across 3 processes</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">ten_to_the_power</span><span class="p">(</span><span class="n">worker</span><span class="o">=</span><span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="n">n_procs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="n">cache_root</span><span class="p">)</span>

    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">p5</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">out</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10^5 = </span><span class="si">{</span><span class="n">p5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
10^5 = 100000
</pre></div></div>
</div>
<p>Alternatively, the worker object can be initialised in the calling code and passed directly to the execution call</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydra.engine.workers</span> <span class="kn">import</span> <span class="n">ConcurrentFuturesWorker</span>

<span class="n">ten_to_the_power</span> <span class="o">=</span> <span class="n">TenToThePower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>

<span class="c1"># Run the 5 tasks in parallel split across 3 processes</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">ten_to_the_power</span><span class="p">(</span><span class="n">worker</span><span class="o">=</span><span class="n">ConcurrentFuturesWorker</span><span class="p">(</span><span class="n">n_procs</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="n">p6</span><span class="p">,</span> <span class="n">p7</span><span class="p">,</span> <span class="n">p8</span><span class="p">,</span> <span class="n">p9</span><span class="p">,</span> <span class="n">p10</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">out</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;10^10 = </span><span class="si">{</span><span class="n">p10</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
10^10 = 10000000000
</pre></div></div>
</div>
</section>
<section id="Reusing-previously-generated-results">
<h2>Reusing previously generated results<a class="headerlink" href="#Reusing-previously-generated-results" title="Permalink to this heading">¶</a></h2>
<p>Pydra caches all task results in the runtime cache (see <a class="reference external" href="./1-getting-started.html##File-system-locations">File-system locations</a>) as long as exactly the hashes of the inputs provided to the task are the same. Here we go through some of the practicalities of this caching and hashing (see <a class="reference external" href="../explanation/hashing-caching.html">Caches and hashes</a> for more details and issues to consider).</p>
<p>If we attempt to run the same task with the same parameterisation the cache directory will point to the same location and the results will be reused</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">fileformats.medimage</span> <span class="kn">import</span> <span class="n">Nifti1</span>
<span class="kn">from</span> <span class="nn">pydra.engine.submitter</span> <span class="kn">import</span> <span class="n">Submitter</span>
<span class="kn">from</span> <span class="nn">pydra.tasks.mrtrix3.v3_0</span> <span class="kn">import</span> <span class="n">MrGrid</span>

<span class="c1"># Make a temporary directory</span>
<span class="n">test_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">())</span>
<span class="n">nifti_dir</span> <span class="o">=</span> <span class="n">test_dir</span> <span class="o">/</span> <span class="s2">&quot;nifti&quot;</span>
<span class="n">nifti_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="c1"># Generate some random NIfTI files to work with</span>
<span class="n">nifti_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">Nifti1</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nifti_dir</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="n">VOX_SIZES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">mrgrid_varying_vox</span> <span class="o">=</span> <span class="n">MrGrid</span><span class="p">(</span><span class="n">operation</span><span class="o">=</span><span class="s2">&quot;regrid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="s2">&quot;voxel&quot;</span><span class="p">),</span>
    <span class="n">in_file</span><span class="o">=</span><span class="n">nifti_files</span><span class="p">,</span>
    <span class="n">voxel</span><span class="o">=</span><span class="n">VOX_SIZES</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">submitter</span> <span class="o">=</span> <span class="n">Submitter</span><span class="p">(</span><span class="n">cache_dir</span><span class="o">=</span><span class="n">test_dir</span> <span class="o">/</span> <span class="s2">&quot;cache&quot;</span><span class="p">)</span>


<span class="k">with</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">submitter</span><span class="p">(</span><span class="n">mrgrid_varying_vox</span><span class="p">)</span>


<span class="n">mrgrid_varying_vox2</span> <span class="o">=</span> <span class="n">MrGrid</span><span class="p">(</span><span class="n">operation</span><span class="o">=</span><span class="s2">&quot;regrid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="s2">&quot;voxel&quot;</span><span class="p">),</span>
    <span class="n">in_file</span><span class="o">=</span><span class="n">nifti_files</span><span class="p">,</span>
    <span class="n">voxel</span><span class="o">=</span><span class="n">copy</span><span class="p">(</span><span class="n">VOX_SIZES</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Result from previous run is reused as the task and inputs are identical</span>
<span class="k">with</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">submitter</span><span class="p">(</span><span class="n">mrgrid_varying_vox2</span><span class="p">)</span>

<span class="c1"># Check that the output directory is the same for both runs</span>
<span class="k">assert</span> <span class="n">result2</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">==</span> <span class="n">result1</span><span class="o">.</span><span class="n">output_dir</span>

<span class="c1"># Change the voxel sizes to resample the NIfTI files to for one of the files</span>
<span class="n">mrgrid_varying_vox2</span><span class="o">.</span><span class="n">voxel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">]</span>

<span class="c1"># Result from previous run is reused as the task and inputs are identical</span>
<span class="k">with</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">result3</span> <span class="o">=</span> <span class="n">submitter</span><span class="p">(</span><span class="n">mrgrid_varying_vox2</span><span class="p">)</span>

<span class="c1"># The output directory will be different as the inputs are now different</span>
<span class="k">assert</span> <span class="n">result3</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">!=</span> <span class="n">result1</span><span class="o">.</span><span class="n">output_dir</span>
</pre></div>
</div>
</div>
<p>Note that for file objects, the contents of the files are used to calculate the hash not their paths. Therefore, when inputting large files there might be some additional overhead on the first run (the file hashes themselves are cached by path and mtime so shouldn’t need to be recalculated unless they are modified). However, this makes the hashes invariant to file-system movement. For example, changing the name of one of the files in the nifti directory won’t invalidate the hash.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rename a NIfTI file within the test directory</span>
<span class="n">nifti_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nifti1</span><span class="p">(</span>
    <span class="n">nifti_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fspath</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">nifti_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fspath</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;first.nii&quot;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">mrgrid_varying_vox3</span> <span class="o">=</span> <span class="n">MrGrid</span><span class="p">(</span><span class="n">operation</span><span class="o">=</span><span class="s2">&quot;regrid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="s2">&quot;voxel&quot;</span><span class="p">),</span>
    <span class="n">in_file</span><span class="o">=</span><span class="n">nifti_files</span><span class="p">,</span>
    <span class="n">voxel</span><span class="o">=</span><span class="n">VOX_SIZES</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Result from previous run is reused as contents of the files have not changed, despite</span>
<span class="c1"># the file names changing</span>
<span class="k">with</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">result4</span> <span class="o">=</span> <span class="n">submitter</span><span class="p">(</span><span class="n">mrgrid_varying_vox3</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">result4</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">==</span> <span class="n">result1</span><span class="o">.</span><span class="n">output_dir</span>

<span class="c1"># Replace the first NIfTI file with a new file</span>
<span class="n">nifti_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nifti1</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nifti_dir</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Update the in_file input field to include the new file</span>
<span class="n">mrgrid_varying_vox4</span> <span class="o">=</span> <span class="n">MrGrid</span><span class="p">(</span><span class="n">operation</span><span class="o">=</span><span class="s2">&quot;regrid&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;in_file&quot;</span><span class="p">,</span> <span class="s2">&quot;voxel&quot;</span><span class="p">),</span>
    <span class="n">in_file</span><span class="o">=</span><span class="n">nifti_files</span><span class="p">,</span>
    <span class="n">voxel</span><span class="o">=</span><span class="n">VOX_SIZES</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The results from the previous runs are ignored as the files have changed</span>
<span class="k">with</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">result4</span> <span class="o">=</span> <span class="n">submitter</span><span class="p">(</span><span class="n">mrgrid_varying_vox4</span><span class="p">)</span>

<span class="c1"># The cache directory for the new run is different</span>
<span class="k">assert</span> <span class="n">result4</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">!=</span> <span class="n">result1</span><span class="o">.</span><span class="n">output_dir</span>
</pre></div>
</div>
</div>
</section>
<section id="Environments-and-hooks">
<h2>Environments and hooks<a class="headerlink" href="#Environments-and-hooks" title="Permalink to this heading">¶</a></h2>
<p>For shell tasks, it is possible to specify that the command runs within a specific software environment, such as those provided by software containers (e.g. Docker or Singularity/Apptainer). This is down by providing the environment to the submitter/execution call,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">pydra.tasks.mrtrix3.v3_0</span> <span class="kn">import</span> <span class="n">MrGrid</span>
<span class="kn">from</span> <span class="nn">pydra.engine.environments</span> <span class="kn">import</span> <span class="n">Docker</span>

<span class="n">test_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

<span class="n">nifti_file</span> <span class="o">=</span> <span class="n">Nifti1</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">test_dir</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Instantiate the task definition, &quot;splitting&quot; over all NIfTI files in the test directory</span>
<span class="c1"># by splitting the &quot;input&quot; input field over all files in the directory</span>
<span class="n">mrgrid</span> <span class="o">=</span> <span class="n">MrGrid</span><span class="p">(</span><span class="n">in_file</span><span class="o">=</span><span class="n">nifti_file</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;regrid&quot;</span><span class="p">,</span> <span class="n">voxel</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="c1"># Run the task to resample all NIfTI files</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">mrgrid</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">Docker</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="s2">&quot;mrtrix3/mrtrix3&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span><span class="p">))</span>

<span class="c1"># Print the locations of the output files</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ImageFormat(&#39;/home/runner/.cache/pydra/0.25.dev391+g33014fac/run-cache/shell-29ed07515aadbd592ddadd20f9308f01/out_file.mif&#39;)
</pre></div></div>
</div>
<p>Of course for this to work Docker needs to work and be configured for <a class="reference external" href="https://docs.docker.com/engine/install/linux-postinstall/">sudo-less execution</a>. See <a class="reference internal" href="../explanation/environments.html"><span class="doc">Containers and Environments</span></a> for more details on how to utilise containers and add support for other software environments.</p>
<p>It is also possible to specify functions to run at hooks that are immediately before and after the task is executed by passing a <code class="docutils literal notranslate"><span class="pre">pydra.engine.spec.TaskHooks</span></code> object to the <code class="docutils literal notranslate"><span class="pre">hooks</span></code> keyword arg. The callable should take the <code class="docutils literal notranslate"><span class="pre">pydra.engine.core.Task</span></code> object as its only argument and return None. The available hooks to attach functions are:</p>
<ul class="simple">
<li><p>pre_run: before the task cache directory is created</p></li>
<li><p>pre_run_task: after the cache directory has been created and the inputs resolved but before the task is executed</p></li>
<li><p>post_run_task: after the task has been run and the outputs collected</p></li>
<li><p>post_run: after the cache directory has been finalised</p></li>
</ul>
<p>QUESTION: What are these hooks intended for? Should the post_run_task hook be run before the outputs have been collected?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydra.engine.core</span> <span class="kn">import</span> <span class="n">Task</span>
<span class="kn">from</span> <span class="nn">pydra.engine.specs</span> <span class="kn">import</span> <span class="n">TaskHooks</span><span class="p">,</span> <span class="n">Result</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>


<span class="k">def</span> <span class="nf">notify_task_completion</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">Task</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">):</span>
    <span class="c1"># Print a message to the terminal</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task completed! Results are stored in </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Platform-specific notifications</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Darwin&quot;</span><span class="p">:</span>  <span class="c1"># macOS</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span>
            <span class="s1">&#39;osascript -e </span><span class="se">\&#39;</span><span class="s1">display notification &quot;Task has completed successfully!&quot; &#39;</span>
            <span class="s1">&#39;with title &quot;Task Notification&quot;</span><span class="se">\&#39;</span><span class="s1">&#39;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Linux&quot;</span><span class="p">:</span>  <span class="c1"># Linux</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;notify-send &quot;Task Notification&quot; &quot;Task has completed successfully!&quot;&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>  <span class="c1"># Windows</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;msg * &quot;Task has completed successfully!&quot;&#39;</span><span class="p">)</span>


<span class="c1"># Run the task to resample all NIfTI files</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">mrgrid</span><span class="p">(</span>
    <span class="n">hooks</span><span class="o">=</span><span class="n">TaskHooks</span><span class="p">(</span><span class="n">post_run</span><span class="o">=</span><span class="n">notify_task_completion</span><span class="p">),</span> <span class="n">cache_dir</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Print the locations of the output files</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">out_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Task completed! Results are stored in &#39;/tmp/tmp_cbsk7fs/shell-29ed07515aadbd592ddadd20f9308f01&#39;
ImageFormat(&#39;/tmp/tmp_cbsk7fs/shell-29ed07515aadbd592ddadd20f9308f01/out_file.mif&#39;)
</pre></div></div>
</div>
</section>
<section id="Provenance-and-auditing">
<h2>Provenance and auditing<a class="headerlink" href="#Provenance-and-auditing" title="Permalink to this heading">¶</a></h2>
<p>Work in progress…</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="3-troubleshooting.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Troubleshooting</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="1-getting-started.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Getting started</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Nipype developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Advanced execution</a><ul>
<li><a class="reference internal" href="#Submitter">Submitter</a></li>
<li><a class="reference internal" href="#Workers">Workers</a></li>
<li><a class="reference internal" href="#Reusing-previously-generated-results">Reusing previously generated results</a></li>
<li><a class="reference internal" href="#Environments-and-hooks">Environments and hooks</a></li>
<li><a class="reference internal" href="#Provenance-and-auditing">Provenance and auditing</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>