

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>State and Nested Loops over Input &mdash; Pydra: A simple dataflow engine with scalable semantics 0.25.dev198+gb207551d documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
      <script src="_static/jquery.js"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Grouping Task’s Output" href="combiner.html" />
    <link rel="prev" title="Dataflows Components: Task and Workflow" href="components.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Pydra: A simple dataflow engine with scalable semantics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="components.html">Dataflows Components: Task and Workflow</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">State and Nested Loops over Input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#types-of-splitter">Types of Splitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scalar-splitter">Scalar Splitter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#outer-splitter">Outer Splitter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="combiner.html">Grouping Task’s Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_spec.html">Input Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_spec.html">Output Specification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Library API (application programmer interface)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Pydra: A simple dataflow engine with scalable semantics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="user_guide.html">User Guide</a></li>
      <li class="breadcrumb-item active">State and Nested Loops over Input</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/state.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="state-and-nested-loops-over-input">
<h1>State and Nested Loops over Input<a class="headerlink" href="#state-and-nested-loops-over-input" title="Permalink to this heading"></a></h1>
<p>One of the main goals of creating Pydra was to support flexible evaluation of a Task or a Workflow
over combinations of input parameters.
This is the key feature that distinguishes it from most other dataflow engines.
This is similar to the concept of the <a class="reference external" href="https://en.wikipedia.org/wiki/MapReduce">Map-Reduce</a>, but extends it to work over arbitrary nested graphs.
In complex dataflows, this would typically involve significant overhead for data management
and use of multiple nested loops.
In Pydra, this is controlled by setting specific State related attributes through Task methods.
In order to set input splitting (or mapping), Pydra requires setting up a splitter.
This is done using Task’s split method.
The simplest example would be a Task that has one field x in the input, and therefore there
is only one way of splitting its input.
Assuming that the user provides a list as a value of x, Pydra splits the list, so each copy
of the Task will get one element of the list.
This can be represented as follow:</p>
<div class="math notranslate nohighlight">
\[S = x: x=[x_1, x_2, ..., x_n] \longmapsto x=x_1, x=x_2, ..., x=x_n~,\]</div>
<p>where S represents the splitter, and x is the input field.
This is also represented in the diagram, where <span class="math notranslate nohighlight">\(x=[1, 2, 3]\)</span> as an example, and the coloured
nodes represent stateless copies of the original Task after splitting the input,
(these are the runnables that are executed).</p>
<a class="reference internal image-reference" href="_images/nd_spl_1.png"><img alt="_images/nd_spl_1.png" src="_images/nd_spl_1.png" style="width: 296.0px; height: 258.0px;" /></a>
<section id="types-of-splitter">
<h2>Types of Splitter<a class="headerlink" href="#types-of-splitter" title="Permalink to this heading"></a></h2>
<p>Whenever a <em>Task</em> has more complicated inputs,
i.e. multiple fields, there are two ways of creating the mapping,
each one is used for different application.
These <em>splitters</em> are called <em>scalar splitter</em> and <em>outer splitter</em>.
They use a special, but Python-based syntax as described next.</p>
</section>
<section id="scalar-splitter">
<h2>Scalar Splitter<a class="headerlink" href="#scalar-splitter" title="Permalink to this heading"></a></h2>
<p>A <em>scalar splitter</em> performs element-wise mapping and requires that the lists of
values for two or more fields to have the same length. The <em>scalar splitter</em> uses
Python tuples and its operation is therefore represented by a parenthesis, <code class="docutils literal notranslate"><span class="pre">()</span></code>:</p>
<div class="math notranslate nohighlight">
\[S = (x, y) : x=[x_1, x_2, .., x_n],~y=[y_1, y_2, .., y_n] \mapsto (x, y)=(x_1, y_1),..., (x, y)=(x_n, y_n),\]</div>
<p>where <cite>S</cite> represents the <em>splitter</em>, <cite>x</cite> and <cite>y</cite> are the input fields.
This is also represented as a diagram:</p>
<figure class="h align-default">
<a class="reference internal image-reference" href="_images/nd_spl_4.png"><img alt="_images/nd_spl_4.png" src="_images/nd_spl_4.png" style="width: 302.40000000000003px; height: 224.0px;" /></a>
</figure>
</section>
<section id="outer-splitter">
<h2>Outer Splitter<a class="headerlink" href="#outer-splitter" title="Permalink to this heading"></a></h2>
<p>The second option of mapping the input, when there are multiple fields, is
provided by the <em>outer splitter</em>. The <em>outer splitter</em> creates all combination
of the input values and does not require the lists to have the same lengths.
The <em>outer splitter</em> uses Python’s list syntax and is represented by square
brackets, <code class="docutils literal notranslate"><span class="pre">[]</span></code>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}S = [x, y] &amp;:&amp; x=[x_1, x_2, ..., x_n],~~ y=[y_1, y_2, ..., y_m], \\
&amp;\mapsto&amp; (x, y)=(x_1, y_1), (x, y)=(x_1, y_2)..., (x, y)=(x_n, y_m).\end{split}\]</div>
<p>The <em>outer splitter</em> for a node with two input fields is schematically represented in the diagram:</p>
<figure class="h align-default">
<a class="reference internal image-reference" href="_images/nd_spl_3.png"><img alt="_images/nd_spl_3.png" src="_images/nd_spl_3.png" style="width: 407.20000000000005px; height: 239.20000000000002px;" /></a>
</figure>
<p>Different types of splitters can be combined over inputs such as
<cite>[inp1, (inp2, inp3)]</cite>. In this example an <em>outer splitter</em> provides all
combinations of values of <cite>inp1</cite> with pairwise combinations of values of <cite>inp2</cite>
and <cite>inp3</cite>. This can be extended to arbitrary complexity.
In additional, the output can be merge at the end if needed.
This will be explained in the next section.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="components.html" class="btn btn-neutral float-left" title="Dataflows Components: Task and Workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="combiner.html" class="btn btn-neutral float-right" title="Grouping Task’s Output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019 - 2020, The Nipype Developers team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>